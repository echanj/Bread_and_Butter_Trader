<!DOCTYPE html>
<html lang="en">
<head>
  <title>A Bread and Butter Style Pair Trading System</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Include MathJax in the head tag -->
  <script type="text/javascript" async 
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML">
  </script>


<!-- content delivery network CDN support for Bootstrap's CSS and JavaScript. You must also include jQuery-->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
  <style>
    /* Set height of the grid so .sidenav can be 100% (adjust if needed) */
    .row.content {height: 1500px}
    
    /* Set gray background color and 100% height */
    .sidenav {
      background-color: #cfc078;
      height: 100%;
    }
    
    /* Set black background color, white text and some padding */
    footer {
      background-color: #23a8ef;
      color: white;
      padding: 15px;
    }
    
    /* On small screens, set height to 'auto' for sidenav and grid */
    @media screen and (max-width: 767px) {
      .sidenav {
        height: auto;
        padding: 15px;
      }
      .row.content {height: auto;} 
    }
  </style>
</head>
<body>

    <div class="container-fluid">
        <div class="row content">
          <div class="col-sm-2 sidenav">
              <h4 style="font-family: 'Georgia', serif;">
                  PairB&B: <em>"... Backed by math. Designed for markets. Inspired by simplicity ..."</em>
              </h4>
            <ul class="nav nav-pills nav-stacked">
              <li><a href="index.html">Main</a></li>
              <li ><a href="algo_trade.html">Algo-trade </a></li>
              <li ><a href="risk_and_performance.html">Risk and Performance Analysis</a></li>
              <li class="active" ><a href="machine_learn.html">Machine Learning</a></li>
              <li><a href="automated_execution.html">Automated Execution</a></li>
            </ul><br>
            <div class="input-group">
              <input type="text" class="form-control" placeholder="Magnifying glass? ">
              <span class="input-group-btn">
                <button class="btn btn-default" type="button">
                  <span class="glyphicon glyphicon-search"></span>
                </button>
              </span>
            </div>
          </div>

    <div class="col-sm-8">
        
        <div>
            <br>
            <!-- Header Section -->
            <h4>Web pages under construction</h4>
            <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 20px;">
              <!-- Logo -->
              <img src="./images/canva_comic_logo2.jpg" alt="Logo" style="height: 130px; border-radius: 0;">
              
              <!-- Title -->
              <h1 style="font-family: 'Georgia', serif; font-size: 2em; color: #333;">
                <span style="color: #2c3e50;">A Bread and Butter Style</span> 
              <span style="font-style: italic; color: #2980b9;">Pair Trading System:</span> <br>
              <span style="font-weight: lighter; color: #333;">Generalized Pairs Trading "For Dummies"</span> 
              <span style="font-weight: bold; color: #2980b9;">(PairB&B)</span>
              </h1>
            </div>


            <div style="margin-bottom: 20px; color: #333;">
                <h1 style="font-family: 'Georgia', serif; color: #2c3e50;">
                    This Page Isn’t About Machine Learning...
                </h1>
                <p style="font-size: 16px; line-height: 1.6;">
                    Here, we document a few simple ways that machine learning can be applied to the data generated by our trading Automata, so as to improve our performance metrics (<a href="./risk_and_performance.html" style="text-decoration: none; color: #403df2c7;"> see more about performance and profitability here </a>). The goal is to keep it straightforward. The underlying principles here align with many of the core applications where machine learning shows promise. We have tested a number of techniques, including reinforcement learning. However, after evaluating many different methods of classification and regression on a reasonable amount of simulated portfolio data, we found that random forest and gradient boosting approaches are still applicable in the context of large feature spaces with data that has limited signal to noise yet is straightforward to train and tune. Also, the results, at least for now, appear robust. Stay tuned for more...    
                </p>
            </div>

            <div style="margin-bottom: 20px; color: #333;">
                <h1 style="font-family: 'Georgia', serif; color: #2c3e50;">
                  Example of Pair Trader Running a Portfolio Simulation
                </h1>
              
                <p style="font-size: 16px; line-height: 1.6;">
                  The PairTrader can be run for portfolio simulation, where datablocks and settings are inputs.
                  Settings include the start and end of the evaluation period (test data period). Below is an example
                  output from runtime:
                </p>
              
                <pre style="font-family: 'Courier New', monospace; font-size: 10px; background-color: #f9f9f9; padding: 10px; border-radius: 8px; border: 1px solid #ddd; line-height: 1.5;">
              number of entries in data table: 505
              number of days for input: 505
              data start date: 2022-09-13, data end date: 2024-09-11
              full date range total periods: 505
              periods per day approx: 1.0 
              For this run using post-signal generation and not halflife!
              
              ... evaluating step t: 475 @2024-08-01 00:00:00 out of final step: 495  @2024-08-29 00:00:00...
              preprocessing historical data block from index datetime 223 2023-08-03 00:00:00 until 474 2024-07-31 00:00:00
              corresponding with date list [223] until [474]
              checking length of historical return block same as lookback period: True
              There are 103 columns being filtered that have fraction of zero returns > threshold: 0.15 !!!
              There are 112 Pair trading z-score signals after cointegration testing and metrics.
              There are 87 Pair trading z-score signals after the halflife filter.
              Checking pairs are on opposite sides of the principal eigenvector and check for any displacement if focus symbol is present: 20
              There are 68 Pair trading z-score signals after filtering by penultimate pairs.
              There are 19 Pair trading z-score signals after filtering by OU mu (i.e., signal mean).
              There are 19 Pair trading z-score signals after filtering by OU sigma (i.e., decay strength).
              There are 19 Pair trading z-score signals after filtering by OU R2.
              There are 19 Pair trading z-score signals after filtering by OU Phi Std Err.
              Running grid searches on historical data only...!
              Running grid searches using the factor model...!
              There are 5 entries in the pairs list for parameter optimization
              finished grid search on historical data entry 1/5 pair: VDHG VHY elapsed time: 2.6587 seconds
              finished grid search on historical data entry 2/5 pair: VDGR VHY elapsed time: 2.6500 seconds
              finished grid search on historical data entry 3/5 pair: MVW VDHG elapsed time: 2.6416 seconds
              finished grid search on historical data entry 4/5 pair: PGF VDHG elapsed time: 2.6505 seconds
              finished grid search on historical data entry 5/5 pair: VGAD VHY elapsed time: 2.6429 seconds
              Generating forward trading signals starting at 2024-08-01 00:00:00 with length of 20 periods ending at 2024-08-28 00:00:00
              Positions Table finished allocating...!
              Evaluation period setting: 20, actual holding period: 17
              
              Mean returns for holding period: 0.082826112771025
              Mean returns for evaluation period: 0.0974424856129706
              Std return over evaluation period: 0.03587820214299237
              Sharpe for evaluation period: 2.7159244274452248
              Profit from initial for strategy: 1.10139393426316
                </pre>

                <p style="font-size: 16px; line-height: 1.6;">
                As per user-specified inputs, the date on which The B&B Automaton will begin to create an N-length (eg. 20 days) simulated portfolio is on the first business day after the designated training period. The simulated portfolio is essentially a backtest. A market ecosystem timeseries datablock must include all required dates. The Automaton is then performing multiple backtests and screening using the designated training data and then using this information (i.e. which stocks to trade on and optimal trading parameters) to then generate the N-length portfilio with the designated test data.</p>

                <br>
                <p style="font-size: 16px; line-height: 1.6;">
                    Once the simulation is finished running it will also output a graphical version of the results.   
                </p>
                <img src="./images/vpt_portfolio_sim_example_hist.png" alt="Logo" style="height: 350px;">
                <p style="font-size: 16px; line-height: 1.6;">
                    These are counts of the percent returns \( \%r \) for the portfolio block, where \( \%r = \%r_{\text{stock}} \times \text{position} \)
                </p>
                <br>

                <img src="./images/vpt_portfolio_sim_example_heatmap.png" alt="Logo" style="height: 350px;">
                <p style="font-size: 16px; line-height: 1.6;">
                    This is the position-weighting block. Here the horizontal dimension represents all avaliable stocks from the input timeseries datablock. The vertical dimension is the portfolio period (in this case, 20 days). Long positions are represented by positive values; likewise, short positions are represented by negative values. Zero is used to indicate a null position. Prior to calculating the \( \%r \), position weights are normalized.   
                </p>
                <br>
                <img src="./images/vpt_portfolio_sim_example_equity.png" alt="Logo" style="height: 350px;">
                <p style="font-size: 16px; line-height: 1.6;">
                    This is the equity curve for the portfolio period. 
                </p>
                <br>
              </div>
              
            <div style="margin-bottom: 20px; color: #333;">
                <h1 style="font-family: 'Georgia', serif; color: #2c3e50;">
                  Machine Learning - General Approach and Workflow. 
                </h1>
              
                <p style="font-size: 16px; line-height: 1.6;">
                    Multiple hyper-settings that control the B&B trader are adjusted, which changes the way the trader behaves, and as a result, different stocks will be traded with different trading parameters. The resultant portfolio over any historical time period will be different, and most importantly, the evaluation signal is always from unbiased test data. The automaton thus represents a layer of abstraction that can be used to simulate many automated trading scenarios using a condensed set of hyperparameters. The goal of machine learning is to predict an optimized set of hyperparameters. This workflow is represented in the scheme below. 
                </p>

                    <div style="text-align: center;">
                    <img src="./images/ML_workflow.jpg" alt="Page 3" style="width: 60%; height: auto;">
                    <div style="margin-top: 8px;">

                      <h3>Jupyter notebook with Supervised Learning Classification example.</h3>
                      <p><a href="./notebooks/Demo_ML_PairB&B_outputs_15m.html" style="text-decoration: none; color: #29b941;">Demo Supervised Learning EDA Random Forest (.html view in browser)</a></p>
                      <p><a href="./notebooks/Demo_ML_PairB&B_outputs_15m.ipynb" style="text-decoration: none; color: #29b941;">Demo Supervised Learning EDA Random Forest (as .ipynb)</a></p>
                      
                      <h3>Backtesting and auxillary data used in the notebook </h3>
                      <p><a href="./csv_files/vpt_metrics_SPY15m_no_features.csv" style="text-decoration: none; color: #a329b9d7;"> Simualted portfolios with various hyperparameters    </a></p>
                      <p><a href="./csv_files/vpt_metrics_SPY15m_PCA_features.csv" style="text-decoration: none; color: #a329b9d7;"> Backtesting data augmented with PCA features with one-day and five-day lookback from evaluation date   </a></p>
                      <p><a href="./csv_files/vpt_metrics_SPY15m_PCA1_features.csv" style="text-decoration: none; color: #a329b9d7;"> Backtesting data augmented with PCA features with one-day  lookback from evaluation date   </a></p>

                      <p><a href="./csv_files/GSPC_data_01Dec24.csv" style="text-decoration: none; color: #a329b9d7;"> S&P500 data used to augment the backtesting data </a></p>
                      <p><a href="./csv_files/VIX_data_01Dec24.csv" style="text-decoration: none; color: #a329b9d7;"> VIX data used to augment the backtesting data </a></p>
                    </div>
                  </div>

                    <div>
                    <h3>Machine Learning Questions</h3>
                 <ol>
                    <li>Is there always a combination of hyperparameters that leads to a positive PNL?</li>
                    <li>Is there one combination of hyperparameters that generally helps to reduce risk and maintain a steady profit?</li>
                    <li>
                        If we supplement this backtesting data with other time-dependent features (e.g., market indices, exchange rates, econometric indicators),
                        can we predict which hyperparameter setting to use that will give us the best Sharpe ratio or cash returns in the future?
                    </li>
                </ol>
                </div>
                <p style="font-size: 16px; line-height: 1.6; background-color: #f9f9f9; padding: 10px; border-left: 4px solid #3498db;">
                    If you are using any notebooks or data, please note that the contents of this page are subject to copyright (see below). 
                    Kindly reference appropriately. Don’t hesitate to connect with us. !!!
                </p>
            </div>                 
    </div>

    <footer class="container-fluid">
        <p>  <em> "In an age where experience is often reduced to just another dataset, it's easy to overlook the depth behind real expertise. As corporations chase the next viral sales innovation layered on top of yesterday’s social media framework, the value of rigorous research and system design risks being overshadowed. But in trading—as in engineering—what matters most isn’t the noise, it’s the signal."</em>   </p>
        <p>Copyright © 2022-2050 by Dr. Eric Joseph Chan. All Rights Reserved. <a href="terms-of-use.html">Terms of Use</a></p>
    </footer>

</body>
</html>